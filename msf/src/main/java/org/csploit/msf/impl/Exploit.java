package org.csploit.msf.impl;

import org.csploit.msf.api.MsfException;
import org.csploit.msf.api.module.Target;

import java.io.IOException;

/**
 * Concrete implementation of an exploit
 */
class Exploit extends Module implements InternalExploit {
  private Target[] targets;
  private int defaultTarget = -1;

  public Exploit(String refname) {
    super(refname);
  }

  @Override
  public String getType() {
    return "exploit";
  }

  public void setTargets(Target[] targets) {
    this.targets = targets;
  }

  public void setDefaultTarget(int defaultTarget) {
    this.defaultTarget = defaultTarget;
  }

  public Target[] getTargets() {
    return targets;
  }

  public Target getTarget() {
    String val = datastore.get("TARGET");

    if(val != null) {
      try {
        return targets[Integer.parseInt(val)];
      } catch (NumberFormatException | IndexOutOfBoundsException e) {
        // ignore
      }
    }

    if(defaultTarget >= 0 && defaultTarget < targets.length) {
      return targets[defaultTarget];
    }

    return null;
  }

  @Override
  public void execute() throws IOException, MsfException {
    throw new UnsupportedOperationException("not implemented yet");
  }
}
